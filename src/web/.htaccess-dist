# Apache configuration
Options FollowSymLinks

# Rewriting
<IfModule mod_rewrite.c>
  RewriteEngine On

  # we check if the .html version is here (caching)
  RewriteRule ^$ index.html [QSA]
  RewriteRule ^([^.]+)$ $1.html [QSA]
  RewriteCond %{REQUEST_FILENAME} !-f

  # no, so we redirect to our front web controller
  RewriteRule ^(.*)$ index.php [QSA,L]
</IfModule>


# Redirection for legacy urls
# Releases
RedirectMatch permanent /(fr|en)/discograph(ie|y)/dhr(\d+)(/)? @dhr.url.root@/$1/discography/dhr-$3#release
RedirectMatch permanent /(fr|en)/discograph(ie|y)(/)?$         @dhr.url.root@/$1/#discography

# Archives
RedirectMatch permanent /archives/dhr(\d+).zip      @dhr.url.root@/assets/releases/dhr-$1/archives/dhr-$1_ogg.zip
RedirectMatch permanent /archives/dhr(\d+)_(.*).zip  @dhr.url.root@/assets/releases/dhr-$1/archives/dhr-$1_$2.zip

# Artists
RedirectMatch permanent /(fr|en)/artist(e)?s/ben_et_bene(/)?     @dhr.url.root@/$1/artist/ben-et-bene#artist
RedirectMatch permanent /(fr|en)/artist(e)?s/computer_truck(/)?  @dhr.url.root@/$1/artist/computer-truck#artist
RedirectMatch permanent /(fr|en)/artist(e)?s/goto80(/)?          @dhr.url.root@/$1/artist/goto80#artist
RedirectMatch permanent /(fr|en)/artist(e)?s/miniroc(/)?         @dhr.url.root@/$1/artist/miniroc#artist
RedirectMatch permanent /(fr|en)/artist(e)?s/puyo_puyo(/)?       @dhr.url.root@/$1/artist/puyo-puyo#artist
RedirectMatch permanent /(fr|en)/artist(e)?s/sputnik_booster(/)? @dhr.url.root@/$1/artist/sputnik-booster#artist
RedirectMatch permanent /(fr|en)/artist(e)?s/vicnet(/)?          @dhr.url.root@/$1/artist/vicnet#artist
RedirectMatch permanent /(fr|en)/artist(e)?s/buskerdroid(/)?     @dhr.url.root@/$1/artist/buskerdroid#artist
RedirectMatch permanent /(fr|en)/artist(e)?s/eat_rabbit(/)?      @dhr.url.root@/$1/artist/eat-rabbit#artist
RedirectMatch permanent /(fr|en)/artist(e)?s/guyom(/)?           @dhr.url.root@/$1/artist/guyom#artist
RedirectMatch permanent /(fr|en)/artist(e)?s/jacques_cochise(/)? @dhr.url.root@/$1/artist/jacques-cochise#artist
RedirectMatch permanent /(fr|en)/artist(e)?s/pocketmaster(/)?    @dhr.url.root@/$1/artist/pocketmaster#artist
RedirectMatch permanent /(fr|en)/artist(e)?s/sidabitball(/)?     @dhr.url.root@/$1/artist/sidabitball#artist
RedirectMatch permanent /(fr|en)/artist(e)?s/tom_woxom(/)?       @dhr.url.root@/$1/artist/tom-woxom#artist
RedirectMatch permanent /(fr|en)/artist(e)?s/xerak(/)?           @dhr.url.root@/$1/artist/xerak#artist
RedirectMatch permanent /(fr|en)/artist(e)?s(/index.php)?        @dhr.url.root@/$1/#artists

# Misc
RedirectMatch permanent /(fr|en)/informations(/)?  @dhr.url.root@/$1/#informations
RedirectMatch permanent /(fr|en)/contact(/)?       @dhr.url.root@/$1/#contact
RedirectMatch permanent /(fr|en)/(links|liens)(/)? @dhr.url.root@/$1/#links

# mod_pagespeed
<IfModule pagespeed_module>
  ModPagespeed on
  ModPagespeedEnableFilters CoreFilters,insert_image_dimensions,defer_javascript,extend_cache
</IfModule>

# New Relic
php_value newrelic.appname "DHR"
php_value newrelic.error_collector.record_database_errors 1
php_value newrelic.transaction_tracer.top100 1
php_value newrelic.transaction_tracer.explain_enabled 1
php_value newrelic.capture_params 1
php_value newrelic.framework symfony
